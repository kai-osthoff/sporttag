---
phase: 08-installation-readme
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/install.sh
  - README.md
autonomous: true

must_haves:
  truths:
    - "Copying curl command from README and pasting into Terminal downloads and installs the app"
    - "After installation, app opens without Gatekeeper warning"
    - "README is in German and understandable for non-technical users"
    - "README shows the curl command prominently for easy copying"
  artifacts:
    - path: "scripts/install.sh"
      provides: "Bash installer script with architecture detection, DMG handling, xattr"
      min_lines: 50
    - path: "README.md"
      provides: "German installation guide with curl command"
      min_lines: 40
      contains: "curl -fsSL"
  key_links:
    - from: "README.md"
      to: "scripts/install.sh"
      via: "raw.githubusercontent.com URL reference"
      pattern: "raw\\.githubusercontent\\.com.*install\\.sh"
    - from: "scripts/install.sh"
      to: "GitHub Releases"
      via: "api.github.com version lookup and DMG download"
      pattern: "api\\.github\\.com.*releases/latest"
---

<objective>
Create one-command installation experience for non-technical German teachers.

Purpose: Enable teachers to install Sporttag by copying a single curl command from the README, without understanding Terminal, DMGs, or Gatekeeper. The script handles architecture detection (ARM vs Intel), downloads the correct DMG, installs to /Applications, removes Gatekeeper quarantine, and launches the app.

Output: scripts/install.sh (installer script) and README.md (German documentation)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-installation-readme/08-CONTEXT.md
@.planning/phases/08-installation-readme/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create installer script</name>
  <files>scripts/install.sh</files>
  <action>
Create scripts/install.sh - a bash installer script that:

1. **Header and config:**
   - Shebang: #!/bin/bash
   - set -e for exit on error
   - Config variables: REPO="kai-osthoff/sporttag", APP_NAME="Sporttag", TEMP_DMG="/tmp/Sporttag.dmg", MOUNT_POINT="/Volumes/Sporttag"

2. **Cleanup trap:**
   - cleanup() function that unmounts MOUNT_POINT if exists and removes TEMP_DMG
   - trap cleanup EXIT

3. **Architecture detection:**
   - MUST use /usr/bin/uname -m (NOT just uname - GNU coreutils on Apple Silicon returns wrong value)
   - arm64 -> DMG_SUFFIX="-arm64", print "Apple Silicon (M-Chip) erkannt"
   - x86_64 -> DMG_SUFFIX="", print "Intel-Prozessor erkannt"
   - else -> print "Fehler: Unbekannte Architektur" to stderr, exit 1

4. **Version lookup:**
   - print "Pruefe neueste Version..."
   - curl -sL GitHub API releases/latest endpoint
   - Extract tag_name with grep + cut + sed (remove v prefix)
   - If empty, print "Fehler: Konnte Version nicht ermitteln" to stderr, exit 1

5. **Download:**
   - Construct DMG_NAME="Sporttag-${VERSION}${DMG_SUFFIX}.dmg"
   - Construct DOWNLOAD_URL from releases/download/v${VERSION}/${DMG_NAME}
   - print "Lade ${APP_NAME} ${VERSION} herunter..."
   - curl -L -# -o "${TEMP_DMG}" "${DOWNLOAD_URL}" (progress bar)

6. **Install:**
   - print "Installiere nach /Applications..."
   - /usr/bin/hdiutil attach "${TEMP_DMG}" -nobrowse -quiet
   - /usr/bin/rsync -a "${MOUNT_POINT}/${APP_NAME}.app" /Applications/
   - /usr/bin/hdiutil detach "${MOUNT_POINT}" -quiet

7. **Gatekeeper bypass:**
   - print "Sicherheitssperre wird entfernt..."
   - /usr/bin/xattr -r -d com.apple.quarantine "/Applications/${APP_NAME}.app" 2>/dev/null || true

8. **Launch:**
   - print "Starte ${APP_NAME}..."
   - /usr/bin/open "/Applications/${APP_NAME}.app"
   - print "Installation abgeschlossen!"
   - print "${APP_NAME} wurde nach /Applications installiert."

All progress messages in German. Use echo for output. Empty lines between sections for readability.
  </action>
  <verify>
    - File exists: ls scripts/install.sh
    - Is executable concept (shebang present): head -1 scripts/install.sh | grep -q "#!/bin/bash"
    - Contains architecture detection: grep -q "/usr/bin/uname -m" scripts/install.sh
    - Contains xattr: grep -q "xattr -r -d com.apple.quarantine" scripts/install.sh
    - Contains German messages: grep -q "Lade.*herunter" scripts/install.sh
  </verify>
  <done>
    - scripts/install.sh exists with 50+ lines
    - Uses /usr/bin/uname -m for architecture detection
    - Downloads from GitHub releases
    - Removes Gatekeeper quarantine with xattr
    - German progress output throughout
  </done>
</task>

<task type="auto">
  <name>Task 2: Create German README</name>
  <files>README.md</files>
  <action>
Replace README.md with German user documentation. Structure:

1. **Title and intro:**
   - # Sporttag
   - Brief description: Was die App macht (faire Zuteilung von Schuelern zu Veranstaltungen, Losverfahren)
   - Target audience hint: Fuer Lehrer an Schulen
   - Friendly informal Du-Form throughout

2. **Installation section (PROMINENT):**
   - ## Installation
   - "Kopiere diesen Befehl und fuehre ihn im Terminal aus:"
   - Code block with: curl -fsSL https://raw.githubusercontent.com/kai-osthoff/sporttag/main/scripts/install.sh | bash
   - "Die Installation dauert etwa 30 Sekunden. Danach startet Sporttag automatisch."

3. **Terminal help section:**
   - ### Terminal oeffnen
   - Step-by-step: Cmd + Leertaste -> "Terminal" tippen -> Enter
   - ### Befehl ausfuehren
   - Step-by-step: Kopieren (Cmd + C) -> Einfuegen (Cmd + V) -> Enter

4. **What happens section:**
   - ### Was passiert bei der Installation?
   - Brief explanation: Script laedt App herunter, installiert nach /Applications, entfernt Sicherheitssperre
   - Mention: Funktioniert auf Apple Silicon (M-Chips) und Intel Macs

5. **Gatekeeper explanation:**
   - ### Warum wird eine Sicherheitssperre entfernt?
   - Explain: macOS blockiert Apps ohne Apple-Signatur
   - Context: Signatur kostet $99/Jahr, xattr entfernt nur die Blockade
   - Reassurance: Die App ist Open Source, du kannst den Code einsehen

6. **Features section:**
   - ## Features
   - Bullet list: Veranstaltungen mit Kapazitaeten, Schueler-Anmeldung mit 3 Prioritaeten, Faires Losverfahren, Druckbare Listen

7. **Datensicherheit section:**
   - ## Datensicherheit
   - Alle Daten bleiben lokal auf deinem Mac
   - Keine Cloud, keine Internetverbindung noetig
   - Datenbank-Speicherort: ~/Library/Application Support/Sporttag/

8. **Updates section:**
   - ## Updates
   - "Fuehre den Installationsbefehl erneut aus - die neue Version wird automatisch installiert."
   - Existing data is preserved

9. **Footer:**
   - ## Entwicklung
   - Link to GitHub repo
   - "Feedback und Beitraege willkommen!"

Use German umlauts where appropriate (ae, oe, ue for compatibility). Keep paragraphs short and scannable. Friendly, warm tone.
  </action>
  <verify>
    - File exists: ls README.md
    - Contains curl command: grep -q "curl -fsSL.*install.sh" README.md
    - Contains German: grep -q "Installation" README.md
    - Contains Terminal instructions: grep -q "Terminal" README.md
    - Contains Gatekeeper explanation: grep -q "Sicherheitssperre" README.md
  </verify>
  <done>
    - README.md exists with 40+ lines
    - curl command prominently displayed in code block
    - German language throughout with informal Du-Form
    - Step-by-step Terminal instructions
    - Gatekeeper/xattr explanation included
    - Features and data security sections present
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Script structure check:**
   ```bash
   # Verify script exists and has correct structure
   ls -la scripts/install.sh
   wc -l scripts/install.sh  # Should be 50+ lines
   grep -c "echo" scripts/install.sh  # Multiple echo statements for progress
   ```

2. **README structure check:**
   ```bash
   # Verify README has required sections
   grep -c "##" README.md  # Multiple h2 sections
   grep "curl.*install.sh" README.md  # curl command present
   ```

3. **Key link verification:**
   ```bash
   # README references the script at the correct URL
   grep "raw.githubusercontent.com/kai-osthoff/sporttag/main/scripts/install.sh" README.md
   ```
</verification>

<success_criteria>
1. scripts/install.sh exists with architecture detection, DMG handling, xattr, German output
2. README.md exists with prominent curl command and German step-by-step instructions
3. README references correct raw.githubusercontent.com URL for install script
4. Both files are ready for commit and push to main branch
</success_criteria>

<output>
After completion, create `.planning/phases/08-installation-readme/08-01-SUMMARY.md`
</output>
