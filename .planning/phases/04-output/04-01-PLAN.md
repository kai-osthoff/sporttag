---
phase: 04-output
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/globals.css
  - src/lib/csv.ts
  - src/components/output/list-actions.tsx
autonomous: true

must_haves:
  truths:
    - "Print preview shows proper A4 layout with margins"
    - "Navigation and buttons are hidden in print view"
    - "CSV files download with German umlauts preserved"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Print media query styles"
      contains: "@custom-variant print"
    - path: "src/lib/csv.ts"
      provides: "CSV generation with BOM"
      exports: ["downloadCSV"]
    - path: "src/components/output/list-actions.tsx"
      provides: "Print and export buttons"
      exports: ["ListActions"]
  key_links:
    - from: "src/components/output/list-actions.tsx"
      to: "src/lib/csv.ts"
      via: "import downloadCSV"
      pattern: "import.*downloadCSV.*from.*csv"
---

<objective>
Set up print infrastructure and CSV export utilities for output phase

Purpose: All output lists need consistent print styling (A4, header repetition, no nav) and CSV export functionality. This plan creates the foundation that all list pages will use.

Output: Print-ready CSS, CSV utility function, reusable action buttons component
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-output/04-RESEARCH.md

# Existing files to modify
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add print styles to globals.css</name>
  <files>src/app/globals.css</files>
  <action>
Add Tailwind v4 print variant and print-specific styles to globals.css:

1. Add `@custom-variant print (@media print);` after the existing `@custom-variant dark` line

2. Add print media query block at the end of the file:
```css
@media print {
  @page {
    size: A4 portrait;
    margin: 1.5cm;
  }

  thead {
    display: table-header-group !important;
  }

  tr {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Hide non-essential elements */
  nav, .no-print, .print\\:hidden {
    display: none !important;
  }

  /* Ensure proper text colors for printing */
  body {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}
```

Note: The double backslash in `.print\\:hidden` is needed because Tailwind generates class names with colons.
  </action>
  <verify>
Run `grep -c "@custom-variant print" src/app/globals.css` returns 1
Run `grep -c "@page" src/app/globals.css` returns 1
  </verify>
  <done>Print variant declared, A4 page size set, header repetition enabled, nav hidden in print</done>
</task>

<task type="auto">
  <name>Task 2: Create CSV export utility</name>
  <files>src/lib/csv.ts</files>
  <action>
Create CSV generation utility with UTF-8 BOM for German Excel compatibility:

```typescript
/**
 * Download data as CSV file with UTF-8 BOM for German Excel compatibility.
 * Uses semicolon separator (German Excel default).
 */
export function downloadCSV(
  data: Record<string, unknown>[],
  filename: string
): void {
  if (data.length === 0) return

  // Get headers from first row
  const headers = Object.keys(data[0])

  // Build CSV content with BOM for Excel UTF-8 support
  const BOM = '\uFEFF'
  const csvRows = [
    headers.join(';'), // German Excel uses semicolon
    ...data.map((row) =>
      headers
        .map((header) => {
          const value = String(row[header] ?? '')
          // Escape quotes and wrap if contains special chars
          if (value.includes('"') || value.includes(';') || value.includes('\n')) {
            return `"${value.replace(/"/g, '""')}"`
          }
          return value
        })
        .join(';')
    ),
  ]

  const csvContent = BOM + csvRows.join('\n')
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' })
  const url = URL.createObjectURL(blob)

  const link = document.createElement('a')
  link.href = url
  link.download = filename.endsWith('.csv') ? filename : `${filename}.csv`
  link.click()

  URL.revokeObjectURL(url)
}
```
  </action>
  <verify>
File exists at src/lib/csv.ts
File exports downloadCSV function
  </verify>
  <done>CSV utility handles BOM, semicolons, quote escaping, and automatic file download</done>
</task>

<task type="auto">
  <name>Task 3: Create ListActions component</name>
  <files>src/components/output/list-actions.tsx</files>
  <action>
Create reusable print/export button component:

```typescript
'use client'

import { Button } from '@/components/ui/button'
import { Download, Printer } from 'lucide-react'

interface ListActionsProps {
  onExportCSV: () => void
}

export function ListActions({ onExportCSV }: ListActionsProps) {
  return (
    <div className="flex gap-2 print:hidden">
      <Button variant="outline" onClick={() => window.print()}>
        <Printer className="mr-2 h-4 w-4" />
        Drucken
      </Button>
      <Button variant="outline" onClick={onExportCSV}>
        <Download className="mr-2 h-4 w-4" />
        CSV Export
      </Button>
    </div>
  )
}
```

Create the components/output directory first if needed.
  </action>
  <verify>
File exists at src/components/output/list-actions.tsx
File exports ListActions component
Grep for "print:hidden" in the file to confirm print hiding
  </verify>
  <done>ListActions component provides Drucken and CSV Export buttons, hidden during print</done>
</task>

</tasks>

<verification>
1. Print styles in globals.css: `@custom-variant print` present
2. CSV utility exists and exports downloadCSV
3. ListActions component exists and uses print:hidden class
4. Build passes: `npm run build` completes without errors
</verification>

<success_criteria>
- Print infrastructure ready for list pages
- CSV export utility handles German locale (semicolons, BOM)
- Reusable button component for all output pages
- No build errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-output/04-01-SUMMARY.md`
</output>
