appId: "de.sporttag.app"
productName: "Sporttag"

directories:
  output: dist
  buildResources: resources

# Include compiled Electron files and their dependencies
files:
  - "electron/**/*.js"
  - "!electron/**/*.ts"
  - "!**/*.map"
  # Include node_modules needed by electron main process
  - "node_modules/electron-window-state/**/*"
  - "node_modules/jsonfile/**/*"
  - "node_modules/mkdirp/**/*"
  - "node_modules/minimist/**/*"
  - "node_modules/graceful-fs/**/*"
  # Exclude native modules that cause universal binary conflicts
  # (Next.js bundles these but the standalone build in extraResources is self-contained)
  - "!**/node_modules/@img/**/*"
  - "!**/node_modules/sharp/**/*"
  - "!**/node_modules/@next/swc*/**/*"

# Copy standalone build to resources
# Note: Next.js preserves full project path structure (githubrepos/sporttag/)
extraResources:
  - from: ".next/standalone"
    to: "standalone"
    filter:
      - "**/*"
  - from: ".next/static"
    to: "standalone/githubrepos/sporttag/.next/static"
  - from: "public"
    to: "standalone/githubrepos/sporttag/public"
  # Include migration files for schema updates
  - from: "src/db/migrations"
    to: "standalone/src/db/migrations"

# Native modules unpacked from ASAR for better-sqlite3
asarUnpack:
  - "**/node_modules/better-sqlite3/**/*"

mac:
  category: "public.app-category.education"
  minimumSystemVersion: "12.0"
  identity: null
  target:
    - target: dmg
      # Build both architectures as separate DMGs
      # Universal binary not possible locally due to better-sqlite3 in Next.js standalone
      # GitHub Actions can merge with lipo command if universal is needed
      arch:
        - arm64
        - x64

dmg:
  title: "Sporttag"
  backgroundColor: "#2d2d2d"
  window:
    width: 660
    height: 400
  iconSize: 100
  contents:
    - x: 180
      y: 200
      type: file
    - x: 480
      y: 200
      type: link
      path: /Applications
